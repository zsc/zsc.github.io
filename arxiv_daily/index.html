
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>今日学术速递</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", "Arial", sans-serif; line-height: 1.6; color: #333; background-color: #f8f9fa; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
        h1, h2 { color: #2c3e50; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #dee2e6; }
        th { background-color: #f2f2f2; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .paper-title-row { cursor: pointer; transition: background-color 0.2s; }
        .paper-title-row:hover { background-color: #e9ecef; }
        .paper-title-row.expanded { background-color: #e2e6ea; }
        .paper-title { font-weight: bold; }
        .details-row { display: none; } /* Hidden by default */
        .details-row.show { display: table-row; } /* Revealed on click */
        .details-cell { padding: 20px 25px !important; background-color: #f8f9fa; }
        .authors { font-style: italic; color: #555; margin-top: 8px; display: block; }
        .abstract { margin-top: 10px; }
        #loader { text-align: center; font-size: 1.2em; padding: 50px; }
    </style>
</head>
<body>
    <div class="container" id="report-container">
        <h1>今日学术速递</h1>
        <p id="intro">正在加载和渲染论文数据... 将鼠标悬停在论文标题上可查看详细摘要。</p>
        <div id="loader">
            <p>Loading...</p>
        </div>
        <div id="clusters-content"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get date from URL param 'date', default to today's date in YYYY-MM-DD format
            const urlParams = new URLSearchParams(window.location.search);
            const dateParam = urlParams.get('date');
            const dateString = dateParam || new Date().toISOString().slice(0, 10);

            const papersFile = `${dateString}.json`;
            const clustersFile = `clusters_${dateString}.json`;
            const container = document.getElementById('clusters-content');
            const loader = document.getElementById('loader');
            const intro = document.getElementById('intro');

            Promise.all([
                fetch(papersFile).then(res => res.json()),
                fetch(clustersFile).then(res => res.json())
            ])
            .then(([papersData, clustersData]) => {
                loader.style.display = 'none';
                if (Object.keys(clustersData).length === 0) {
                    intro.textContent = '今日未发现相关主题的论文分组。';
                    return;
                }

                const papersMap = new Map(papersData.map(p => [p.id, p]));
                intro.textContent = `根据您的学术兴趣，今日的论文已为您整理成以下 ${Object.keys(clustersData).length} 个主题。点击论文标题可展开查看摘要。`;

                for (const [clusterTitle, paperIds] of Object.entries(clustersData)) {
                    const section = document.createElement('section');
                    const title = document.createElement('h2');
                    title.textContent = clusterTitle;
                    section.appendChild(title);

                    const table = document.createElement('table');
                    const thead = `<thead><tr><th>论文 (Paper)</th></tr></thead>`;
                    table.innerHTML = thead;
                    const tbody = document.createElement('tbody');

                    paperIds.forEach(paperId => {
                        const paper = papersMap.get(paperId);
                        if (!paper) return;

                        // Create the main row for the title (clickable)
                        const titleRow = tbody.insertRow();
                        titleRow.className = 'paper-title-row';
                        titleRow.innerHTML = `
                            <td>
                                <div class="paper-title">${paper.chinese_title}</div>
                                <div><a href="${paper.pdf_link}" target="_blank" onclick="event.stopPropagation();" title="Download PDF">${paper.title}</a></div>
                            </td>`;

                        // Create the hidden row for details
                        const detailsRow = tbody.insertRow();
                        detailsRow.className = 'details-row';
                        detailsRow.innerHTML = `
                            <td class="details-cell">
                                <strong>作者 (Authors):</strong>
                                <div class="authors">${paper.authors}</div>
                                <strong style="margin-top:10px; display:block;">摘要 (Abstract):</strong>
                                <div class="abstract">${paper.chinese_abstract}</div>
                                <div style="margin-top: 15px;">
                                    <a href="${paper.abs_link}" target="_blank">查看摘要页面 (Abs Page)</a>
                                    <a href="javascript:void(0);" class="collapse-btn" style="margin-left: 20px;">折叠 (Collapse)</a>
                                </div>
                            </td>`;

                        // Add click event listener to toggle visibility of the details row
                        titleRow.addEventListener('click', () => {
                            titleRow.classList.toggle('expanded');
                            detailsRow.classList.toggle('show');
                        });

                        // Add click event listener for the collapse button
                        const collapseBtn = detailsRow.querySelector('.collapse-btn');
                        collapseBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            titleRow.classList.remove('expanded');
                            detailsRow.classList.remove('show');
                        });
                    });
                    table.appendChild(tbody);
                    section.appendChild(table);
                    container.appendChild(section);
                }
            })
            .catch(error => {
                loader.style.display = 'none';
                intro.textContent = '加载论文数据失败。请检查文件是否存在以及网络连接。';
                console.error('Error loading data:', error);
            });
        });
    </script>
</body>
</html>
